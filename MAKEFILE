#==============================================================================
#   GOST makefile: Flashpack 300 and 407 versions 
#                  using an unique source. Jan 2000
#   File Names:
#               - 
#				- 
#				- 
#==============================================================================
all: vnic300a.h00 vnic407a.h00 vnic300b.h00 vnic300c.h00 vnic407b.h00 
	@echo Makefile Done !!
	make clean
clean:
	del *.o
#	del *.exe
#	del *.sym
#==============================================================================
#					Define Library kits and start sequence
#==============================================================================

START = start fblib.lib -lml -lcl

#==============================================================================
#					Define Utility Macros
#==============================================================================

S       = start.o makefile
COMPILE = ng_an_mn.c gost_hd.h gost_glb.h gostvals.h makefile
#
#===  -o switch allows you to change output file name
#
FBRAM  = -C 7000 -D 6800 -t -o vnic407a.exe gost_fb gost407a $(START)
FL3AB  = -C A800 -D A000 -t -o vnic300a.exe gost_300 gost300a $(START)

FB_B   = -C B000 -D 6400 -t -o vnic407b.exe gost_fb gost407b $(START)
FL3_B  = -C D000 -D B800 -t -o vnic300b.exe gost_300 gost300b $(START)
FL3_C  = -C C000 -D A800 -t -o vnic300c.exe gost_300 gost300c $(START)

#==============================================================================
#		Roc 300, ram only flavor(symbol "a"), link and hex translation
#       FOR FLASH 300: RAM in A-B, FLASH in C-D, HISTORY 6-7
#==============================================================================

vnic300a.h00:	vnic300a.exe makefile
	hex86 -x -s64 -p64 vnic300a.exe

vnic300a.exe:	gost_300.o gost300a.o $S
	ln $(FL3AB)

#==============================================================================
#		floboss, ram flavor(symbol "a"), link and hex translation
#==============================================================================

vnic407a.h00:	vnic407a.exe makefile
	hex86 -x -s64 -p64 vnic407a.exe

vnic407a.exe:	gost_fb.o gost407a.o $S
	ln $(FBRAM)

#==============================================================================
#		Roc 300, flash+ram flavor(symbol "b"), link and hex translation
#       FOR FLASH 300: RAM in A-B, FLASH in C-D, HISTORY 6-7
#==============================================================================

vnic300b.h00:	vnic300b.exe makefile
	hex86 -x -s64 -p64 vnic300b.exe

vnic300b.exe:	gost_300.o gost300b.o $S
	ln $(FL3_B)

#==============================================================================
#		Roc 300, flash+ram flavor(symbol "c"), link and hex translation
#       FOR FLASH 300: RAM in A-B, FLASH in C-D, HISTORY 6-7
#==============================================================================

vnic300c.h00:	vnic300c.exe makefile
	hex86 -x -s64 -p64 vnic300c.exe

vnic300c.exe:	gost_300.o gost300c.o $S
	ln $(FL3_C)
#==============================================================================
#		floboss, flash+ram flavor(symbol "b"), link and hex translation
#==============================================================================

vnic407b.h00:	vnic407b.exe makefile
	hex86 -x -s64 -p64 vnic407b.exe

vnic407b.exe:	gost_fb.o gost407b.o $S
	ln $(FB_B)

#================================================================================
#		compile the unique source, with headers and globals
#       two instances are needed for now, for 300 RAM and 407 series
#================================================================================

gost_fb.o: $(COMPILE)
# === FLOBOSS argument is passed to ng_an_mn.c file
	cc +L +1 -Z6000 -DFLOBOSS -ansi ng_an_mn.c -o gost_fb.o

gost_300.o: $(COMPILE)
# === ROC3FLS argument is passed to gost_mn.c file
	cc +L +1 -Z4000 -DROC3FLS -ansi ng_an_mn.c -o gost_300.o

#================================================================================
#		compile asm initialization, starting from u_ints.asm
#       NOTE: each object module generated by u_ints must have the same 
#             name as the target h00 file 
#================================================================================

gost407a.o:     na_ints.asm makefile
# === GOST407A argument is passed to na_ints.asm file
	as -DGOST407A -DMODEL=3 na_ints.asm -o gost407a.o

gost300a.o:     na_ints.asm makefile
# === GOST300A argument is passed to na_ints.asm file
	as -DGOST300A -DMODEL=3 na_ints.asm -o gost300a.o

gost407b.o:     na_ints.asm makefile
# === GOST407B argument is passed to na_ints.asm file
	as -DGOST407B -DMODEL=3 na_ints.asm -o gost407b.o

gost300b.o:     na_ints.asm makefile
# === GOST300B argument is passed to na_ints.asm file
	as -DGOST300B -DMODEL=3 na_ints.asm -o gost300b.o

gost300c.o:     na_ints.asm makefile
# === GOST300C argument is passed to na_ints.asm file
	as -DGOST300C -DMODEL=3 na_ints.asm -o gost300c.o

#================================================================================
#		compile asm start  
#================================================================================

start.o:        start.asm
	as -DMODEL=3 start.asm

#============================ END MAKEFILE ======================================

